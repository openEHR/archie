archetype (adl_version=2.0.5; rm_release=1.0.4)
    openEHR-EHR-OBSERVATION.rules_parent.v0.0.1

language
    original_language = <[ISO_639-1::en]>

description
    original_author = <
        ["name"] = <"Vera">
    >
    lifecycle_state = <"DRAFT">
    details = <
        ["en"] = <
            language = <[ISO-639_1::en]>
            purpose = <"Rules parent archetype testing">
        >
    >

definition
    OBSERVATION[id1] matches {    -- RulesParent
        data matches {
            HISTORY[id2] matches {
                events matches {
                    POINT_EVENT[id3] matches {    -- Point event
                        data matches {
                            ITEM_TREE[id4] matches {
                                items matches {
                                    ELEMENT[id5] occurrences matches {0..1} matches {    -- Count 1
                                        value matches {
                                            DV_COUNT[id6] 
                                        }
                                    }
                                    ELEMENT[id7] occurrences matches {0..1} matches {    -- Count 2
                                        value matches {
                                            DV_COUNT[id8] 
                                        }
                                    }
                                    ELEMENT[id9] occurrences matches {0..1} matches {    -- Sum
                                        value matches {
                                            DV_COUNT[id10] 
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

rules
    /data[id2]/events[id3]/data[id4]/items[id9]/value/magnitude = round(
        /data[id2]/events[id3]/data[id4]/items[id5]/value/magnitude + 
        /data[id2]/events[id3]/data[id4]/items[id7]/value/magnitude)


terminology
    term_definitions = <
        ["en"] = <
            ["id1"] = <
                text = <"RulesParent">
                description = <"Rules parent archetype">
                code = <"id1">
            >
            ["id3"] = <
                text = <"Point event">
                description = <"Point event">
            >
            ["id5"] = <
                text = <"Count 1">
                description = <"">
            >
            ["id7"] = <
                text = <"Count 2">
                description = <"">
            >
            ["id9"] = <
                text = <"Sum">
                description = <"">
            >
        >
    >
